<div class="mb-8">
  <h1 class="text-2xl font-semibold text-white">Search</h1>
  <p class="text-gray-500 text-sm mt-1">Look up wallet address history</p>
</div>

<!-- Search Form -->
<form class="bg-dark-700 border border-dark-500 rounded-xl p-5 mb-6">
  <div class="flex gap-3">
    <input type="text" name="address" value="<%= address %>" placeholder="0x..."
      class="flex-1 bg-dark-800 border border-dark-500 text-white text-sm rounded-lg px-4 py-2.5 font-mono placeholder-gray-500 focus:border-cyan-500 focus:outline-none"
      pattern="^0x[a-fA-F0-9]{40}$">
    <button type="submit" class="px-5 py-2.5 bg-cyan-500 hover:bg-cyan-400 text-white text-sm font-medium rounded-lg transition-colors">Search</button>
  </div>
  <% if (error) { %>
  <div class="mt-3 text-red-400 text-sm"><%= error %></div>
  <% } %>
</form>

<% if (address && !error) { %>
<!-- Address Card -->
<div class="bg-dark-700 border border-dark-500 rounded-xl p-5 mb-6">
  <div class="flex items-center justify-between">
    <div>
      <span class="text-gray-500 text-xs block mb-1">Wallet Address</span>
      <span class="font-mono text-lg text-white"><%= address %></span>
    </div>
    <a href="https://basescan.org/token/<%= aquariAddress %>?a=<%= address %>"
       target="_blank"
       class="px-4 py-2 bg-dark-600 hover:bg-dark-500 text-cyan-400 text-sm rounded-lg border border-dark-500 transition-colors flex items-center gap-2">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
      </svg>
      View on Basescan
    </a>
  </div>
</div>

<!-- Tabs -->
<div class="mb-6 flex border-b border-dark-600">
  <a href="?address=<%= address %>&tab=airdrops"
    class="px-4 py-2 text-sm <%= tab === 'airdrops' ? 'border-b-2 border-cyan-500 text-cyan-400' : 'text-gray-500 hover:text-gray-300' %>">
    Airdrop History
  </a>
  <a href="?address=<%= address %>&tab=balances"
    class="px-4 py-2 text-sm <%= tab === 'balances' ? 'border-b-2 border-cyan-500 text-cyan-400' : 'text-gray-500 hover:text-gray-300' %>">
    Balance History
  </a>
</div>

<% if (results && results.length > 0) { %>
<div class="bg-dark-700 border border-dark-500 rounded-xl overflow-hidden">
  <% if (tab === 'balances') { %>
  <table class="w-full">
    <thead>
      <tr class="bg-dark-800/50">
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Week</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Snapshot Type</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Balance</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Snapshot Date</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-dark-600">
      <% results.forEach(r => {
        const weekParts = r.weekId?.split('-') || [];
        const isStart = r.weekId?.includes('-start');
        const isEnd = r.weekId?.includes('-end');
      %>
      <tr class="hover:bg-dark-600/30 transition-colors">
        <td class="px-5 py-3 font-mono text-sm text-white"><%= r.weekId?.replace('-start', '').replace('-end', '') %></td>
        <td class="px-5 py-3">
          <span class="px-2 py-0.5 text-xs rounded-full <%= isStart ? 'bg-cyan-500/20 text-cyan-400' : 'bg-purple-500/20 text-purple-400' %>">
            <%= isStart ? 'Start' : (isEnd ? 'End' : 'Snapshot') %>
          </span>
        </td>
        <td class="px-5 py-3 text-sm text-emerald-400 font-mono font-medium"><%= r.balanceFormatted %> AQUARI</td>
        <td class="px-5 py-3 text-sm text-gray-500"><%= r.createdAt ? new Date(r.createdAt).toLocaleString() : '—' %></td>
      </tr>
      <% }) %>
    </tbody>
  </table>
  <% } else { %>
  <!-- Airdrops Tab -->
  <table class="w-full">
    <thead>
      <tr class="bg-dark-800/50">
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Week</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Start Balance</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">End Balance</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">MIN Balance</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reward</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
        <th class="px-5 py-3 text-left text-xs font-medium text-gray-500 uppercase">TxHash</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-dark-600">
      <% results.forEach(r => { %>
      <tr class="hover:bg-dark-600/30 transition-colors">
        <td class="px-5 py-3">
          <a href="/admin/distributions/<%= r.distributionId %>" class="font-mono text-sm text-cyan-400 hover:text-cyan-300">
            <%= r.weekId %>
          </a>
        </td>
        <td class="px-5 py-3 text-sm text-gray-400 font-mono">
          <%= r.balances?.start && /^\d+$/.test(r.balances.start) ? (BigInt(r.balances.start) / BigInt(10**18)).toLocaleString() : '—' %>
        </td>
        <td class="px-5 py-3 text-sm text-gray-400 font-mono">
          <%= r.balances?.end && /^\d+$/.test(r.balances.end) ? (BigInt(r.balances.end) / BigInt(10**18)).toLocaleString() : '—' %>
        </td>
        <td class="px-5 py-3 text-sm text-white font-mono font-medium">
          <%= r.balances?.min && /^\d+$/.test(r.balances.min) ? (BigInt(r.balances.min) / BigInt(10**18)).toLocaleString() : '—' %>
        </td>
        <td class="px-5 py-3 text-sm text-emerald-400 font-mono font-medium"><%= r.rewardFormatted || '—' %></td>
        <td class="px-5 py-3">
          <span class="px-2 py-0.5 text-xs rounded-full
            <%= r.status === 'completed' ? 'bg-emerald-500/20 text-emerald-400' :
               r.status === 'failed' ? 'bg-red-500/20 text-red-400' :
               r.status === 'processing' ? 'bg-cyan-500/20 text-cyan-400' :
               'bg-yellow-500/20 text-yellow-400' %>">
            <%= r.status %>
          </span>
        </td>
        <td class="px-5 py-3">
          <% if (r.txHash) { %>
          <a href="https://basescan.org/tx/<%= r.txHash %>" target="_blank"
             class="text-cyan-400 hover:text-cyan-300 font-mono text-xs flex items-center gap-1">
            <%= r.txHash.slice(0,8) %>...
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
            </svg>
          </a>
          <% } else { %><span class="text-gray-600">—</span><% } %>
        </td>
      </tr>
      <% }) %>
    </tbody>
  </table>
  <% } %>
</div>

<% if (pagination.totalPages > 1) { %>
<div class="mt-4 flex justify-center gap-2">
  <% if (pagination.page > 1) { %>
    <a href="?address=<%= address %>&tab=<%= tab %>&page=<%= pagination.page - 1 %>"
       class="px-3 py-1 text-sm rounded bg-dark-700 text-gray-400 hover:text-white">&larr;</a>
  <% } %>
  <%
    let startPage = Math.max(1, pagination.page - 2);
    let endPage = Math.min(pagination.totalPages, pagination.page + 2);
  %>
  <% for (let i = startPage; i <= endPage; i++) { %>
  <a href="?address=<%= address %>&tab=<%= tab %>&page=<%= i %>"
     class="px-3 py-1 text-sm rounded <%= i === pagination.page ? 'bg-cyan-500 text-white' : 'bg-dark-700 text-gray-400 hover:text-white' %>"><%= i %></a>
  <% } %>
  <% if (pagination.page < pagination.totalPages) { %>
    <a href="?address=<%= address %>&tab=<%= tab %>&page=<%= pagination.page + 1 %>"
       class="px-3 py-1 text-sm rounded bg-dark-700 text-gray-400 hover:text-white">&rarr;</a>
  <% } %>
</div>
<% } %>

<% } else if (results) { %>
<div class="bg-dark-700 border border-dark-500 rounded-xl p-8 text-center">
  <div class="text-gray-500 text-sm mb-4">No records found for this address</div>
  <a href="https://basescan.org/token/<%= aquariAddress %>?a=<%= address %>"
     target="_blank"
     class="text-cyan-400 hover:text-cyan-300 text-sm">
    Check AQUARI balance on Basescan →
  </a>
</div>
<% } %>
<% } %>
